# è³‡æ–™åº«æ•ˆèƒ½æ¸¬è©¦å·¥å…·

æœ¬è³‡æ–™å¤¾åŒ…å«ç”¨æ–¼æ¸¬è©¦ç´¢å¼•æ•ˆèƒ½çš„è…³æœ¬å’Œå·¥å…·ã€‚

## ğŸ“ æª”æ¡ˆèªªæ˜

- `generate_test_data.py` - Python è‡ªå‹•åŒ–æ¸¬è©¦è³‡æ–™ç”Ÿæˆå·¥å…·ï¼ˆ**æœƒå…ˆæ¸…ç©ºç¾æœ‰è³‡æ–™**ï¼‰
- `cleanup_test_data.py` - æ¸…ç©ºæ¸¬è©¦è³‡æ–™å·¥å…·ï¼ˆä¿ç•™ schemaï¼‰
- `benchmark_queries.py` - æŸ¥è©¢æ•ˆèƒ½æ¸¬è©¦è…³æœ¬
- `test_index_performance.py` - ç´¢å¼•æ•ˆèƒ½æ¯”è¼ƒå·¥å…·
- `results/` - æ¸¬è©¦çµæœè¼¸å‡ºç›®éŒ„

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. æº–å‚™æ¸¬è©¦ç’°å¢ƒ

```bash
# å®‰è£ä¾è³´
pip install psycopg2-binary

# è¨­ç½®è³‡æ–™åº«é€£ç·šï¼ˆä¿®æ”¹ .env æˆ–ç›´æ¥åœ¨è…³æœ¬ä¸­è¨­å®šï¼‰
export DB_HOST=localhost
export DB_PORT=5432
export DB_NAME=your_database
export DB_USER=your_user
export DB_PASSWORD=your_password
```

### 2. ç”Ÿæˆæ¸¬è©¦è³‡æ–™

**âš ï¸  æ³¨æ„ï¼šé è¨­æœƒå…ˆæ¸…ç©ºæ‰€æœ‰ç¾æœ‰è³‡æ–™ï¼**

```bash
# æ¨™æº–æ–¹å¼ï¼ˆæœƒå…ˆæ¸…ç©ºç¾æœ‰è³‡æ–™ï¼‰
python generate_test_data.py

# è‡ªè¨‚è³‡æ–™é‡
python generate_test_data.py --members 5000 --items 50000

# è·³éæ¸…ç©ºæ­¥é©Ÿï¼ˆä¸æ¨è–¦ï¼Œå¯èƒ½å°è‡´è³‡æ–™è¡çªï¼‰
python generate_test_data.py --skip-cleanup
```

**æˆ–å–®ç¨æ¸…ç©ºè³‡æ–™ï¼š**
```bash
python cleanup_test_data.py
```

### 3. æ¸¬è©¦ç´¢å¼•æ•ˆèƒ½

```bash
# æ¸¬è©¦æ‰€æœ‰ 3 ç¨®é…ç½®ï¼ˆç„¡ç´¢å¼•ã€åŸºç¤ç´¢å¼•ã€å®Œæ•´ç´¢å¼•ï¼‰
python test_index_performance.py --iterations 100

# åªæ¸¬è©¦ç‰¹å®šæŸ¥è©¢
python benchmark_queries.py --query time_conflict --iterations 100
```

## ğŸ“Š æ¸¬è©¦è³‡æ–™è¦æ¨¡

| è¡¨å | è³‡æ–™é‡ | èªªæ˜ |
|------|--------|------|
| member | 10,000 | ç”¨æˆ¶è³‡æ–™ |
| category | 500 (5å±¤æ·±åº¦) | åˆ†é¡æ¨¹ |
| item | 100,000 | ç‰©å“è³‡æ–™ |
| reservation | 50,000 | é ç´„è¨˜éŒ„ |
| reservation_detail | 150,000 | é ç´„è©³ç´° |
| contribution | 80,000 | è²¢ç»è¨˜éŒ„ |
| review | 100,000 | è©•è«–è³‡æ–™ |
| loan | 120,000 | å€Ÿç”¨è¨˜éŒ„ |
| loan_event | 240,000 | å€Ÿç”¨äº‹ä»¶ |
| report | 5,000 | æª¢èˆ‰è¨˜éŒ„ |
| category_ban | 2,000 | ç¦ç”¨è¨˜éŒ„ |

**ç¸½è¨ˆï¼šç´„ 75 è¬ç­†æ¸¬è©¦è³‡æ–™**

## ğŸ” æ¸¬è©¦æŸ¥è©¢

### æŸ¥è©¢ 1ï¼šæ™‚é–“è¡çªæª¢æŸ¥
æ¸¬è©¦ OVERLAPS é‹ç®—ç¬¦èˆ‡è¤‡åˆç´¢å¼•æ•ˆèƒ½

### æŸ¥è©¢ 2ï¼šè²¢ç»æª¢æŸ¥èˆ‡éè¿´åˆ†é¡
æ¸¬è©¦ WITH RECURSIVE + å¤šå±¤ JOIN æ•ˆèƒ½

### æŸ¥è©¢ 3ï¼šç”¨æˆ¶è©•åˆ†è¨ˆç®—
æ¸¬è©¦ CTE + AVG() + å¤šå±¤ JOIN æ•ˆèƒ½

## ğŸ“ˆ é æœŸçµæœ

| æŸ¥è©¢ | ç„¡ç´¢å¼• | å®Œæ•´ç´¢å¼• | æå‡å€æ•¸ |
|------|--------|---------|---------|
| æ™‚é–“è¡çªæª¢æŸ¥ | ~850ms | ~8ms | **106x** |
| è²¢ç»æª¢æŸ¥ | ~1250ms | ~45ms | **27.8x** |
| è©•åˆ†è¨ˆç®— | ~780ms | ~35ms | **22.3x** |

## âš ï¸ æ³¨æ„äº‹é …

1. **è³‡æ–™åº«å‚™ä»½ï¼š** âš ï¸ **åŸ·è¡Œå‰è«‹å…ˆå‚™ä»½è³‡æ–™åº«ï¼æ¸¬è©¦å·¥å…·æœƒæ¸…ç©ºæ‰€æœ‰ç¾æœ‰è³‡æ–™ï¼**
2. **æ¸…ç©ºæ¸¬è©¦è³‡æ–™ï¼š**
   - `generate_test_data.py` é è¨­æœƒå…ˆæ¸…ç©ºè³‡æ–™å†ç”Ÿæˆ
   - ä½¿ç”¨ `cleanup_test_data.py` å¯å–®ç¨æ¸…ç©ºè³‡æ–™
   - ä½¿ç”¨ `--skip-cleanup` å¯è·³éæ¸…ç©ºæ­¥é©Ÿï¼ˆä¸æ¨è–¦ï¼‰
3. **åŸ·è¡Œæ™‚é–“ï¼š** ç”Ÿæˆ 75 è¬ç­†è³‡æ–™ç´„éœ€ 10-15 åˆ†é˜
4. **ç£ç¢Ÿç©ºé–“ï¼š** ç¢ºä¿è‡³å°‘æœ‰ 2GB å¯ç”¨ç©ºé–“
5. **ç¢ºèªæç¤ºï¼š** åŸ·è¡Œæ¸…ç©º/ç”Ÿæˆå‰æœƒè¦æ±‚ç¢ºèªï¼Œè«‹ä»”ç´°æª¢æŸ¥

## ğŸ› ï¸ é€²éšç”¨æ³•

### è‡ªè¨‚è³‡æ–™é‡
```bash
python generate_test_data.py \
  --members 5000 \
  --items 50000 \
  --reservations 25000
```

### åŒ¯å‡ºæ¸¬è©¦çµæœ
```bash
python test_index_performance.py --output results/test_$(date +%Y%m%d).json
```

### æ¯”è¼ƒä¸åŒç´¢å¼•é…ç½®
```bash
# æ¸¬è©¦ç„¡ç´¢å¼•
python benchmark_queries.py --no-index

# æ¸¬è©¦åŸºç¤ç´¢å¼•
python benchmark_queries.py --basic-index

# æ¸¬è©¦å®Œæ•´ç´¢å¼•
python benchmark_queries.py --full-index
```

## ğŸ“ çµæœåˆ†æ

æ¸¬è©¦çµæœæœƒå„²å­˜åœ¨ `results/` ç›®éŒ„ä¸‹ï¼ŒåŒ…å«ï¼š
- å¹³å‡åŸ·è¡Œæ™‚é–“
- P95 / P99 åŸ·è¡Œæ™‚é–“
- ååé‡ (QPS)
- EXPLAIN ANALYZE åŸ·è¡Œè¨ˆç•«

è©³ç´°åˆ†æè«‹åƒè€ƒ `../backend/app/db/INDEX_EXPLANATION.md`
